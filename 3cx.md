![3cx](https://git.poker/lcrs-git/img/blob/master/20220721/3cx.10x6jrqsaaa8.jpg?raw=true)

3CX是一个可以简单上手的系统。但是要想把它玩转，的确要花上不少的时间。

一、安装3CX系统前的准备工作

（一）网络环境

  3CX安装很简单，如果你想快速体验。直接在一台WINDOWS server上点击3CX的EXE安装包。然后一直下一步..就可以快速完成安装了。正常的话，你什么问题都不会遇到。但是如果你们公司是一家大型集团公司，网络结构具有一定的复杂性。那我还是建议你读一读下面这篇文章。可以帮助你日后部署的过程中少走很多弯路。

在本地部署3CX，首先第一个要注意的就是IP地址的选择.这个请慎重，因为一旦决定，以后安装3CX这台服务器，就不能改变IP地址了。除非，你打算重新部署。关于IP地址的注意事项，请查看如下。

3CX系统部署IP地址的注意事项

  此外，我们也有越来越多的用户选择在云端部署3CX。有些用户非常担心在云端部署的可靠性和通话会出现音质问题。如今的网络情况已经不是10年前了。大家可以发展的眼光来看问题。而且在未来，企业通信上云是大势所趋。我们推荐查看下面的文章。

云端IP电话系统通话品质不好的处理建议

另外，有些同学会担心通话的带宽问题。在VOIP通话中，每一通电话都会占用带宽。这篇文章会对这个问题进行进一步的解释

网络电话的带宽占用

（二）安装需要准备的硬件环境
3CX可以部署在标准的X64结构的物理机，虚拟机和主流的云平台上。我们建议不要部署在物理机上。因为物理机的备份和迁移，没有虚拟机和云平台管理方便。

3CX部署的服务器平台配置

令人兴奋的是,3CX还可以部署在卡片电脑树莓派上。在香烟壳大小，价格仅需 ￥399的电脑上，可以部署一套16并发,满足50个人使用的3CX。这一环境经过3CX官方测试超过半年。具有极客精神的朋友千万不要错过。

卡片电脑树莓派运行3CX-IP PBX

（三）安装需要准备的源文件程序
下载3CX的WINDOWS和LINUX主程序文件，可以从下面的链接获取。一开始有的同学会困惑。到底是下载WINDOWS还是LINUX的平台好。如果考虑稳定性，当然是LINUX的。其实WINDWOS的可靠性也不错。因为3CX从诞生之日起，就是WINDOWS平台的，而且已经经过了快15年的版本变更。稳定性已经可以满足绝大多少中小企业的要求了。如果你不是偏执狂，windows平台也是不错的选择。

3CX下载资源

（四）准备好你的防火墙来配合3CX
VOIP的语音是在企业的内网高速公路上行驶的汽车。要想畅通无阻，必须要使得防火墙确保语音通话一路绿灯。

为什么防火墙检测不会说谎

有一些朋友发现安装结束后，敲入域名或者公网IP地址无法访问3CX。那这个多半是端口映射没有做好，无法访问3CX的网络界面。请大家回到上面的步骤进行防火墙检测。并打开相对应的端口。这里强调一些端口映射是

全锥型NAT
确保内外都是用这个端口进行通信。

另外反复发现话机注册不上，也是端口没有正确打开的原因。大家仔细确认需要打开的端口，然后运行防火墙检测。

3CX电话系统使用的完整端口

企业使用的防火墙类型很多，我们用下面一个配置的例子来帮助大家理解防火墙配置的注意事项

配置防火墙

强调一下，一定要禁用SIP ALG

关闭SIP ALG

在阿里云上安装3CX后，只有开放需要的端口，也还是要进行防火墙检测，才可以完成访问和话机的注册。具体可以参考下面的文章

使用阿里云经典网络ECS安装3CX注意事项

（五）3CX系统主程序安装准备工作
1.安装3CX服务器程序
在系统安装之前，请确保你的系统最好只有3CX通信应用，不要安装其它的第3方软件，比如说360杀毒，VPN程序。等等。我们有一个客户在一台已经安装了360的程序后安装3CX，后发现3CX的后台程序被莫名其妙的关闭。同时也不建议安装其它的程序。这里希望大家注意。

安装3CX的服务器注意不要安装第三方杀软

2.准备好自己的FQDN或者使用3CX提供的FQDN
3CX从V15开始，会强制需要安装SSL证书和绑定域名FQDN。获取SSL和域名FQDN证书有两种方式，一种是3CX提供，一种是客户自己提供。大家可以看这篇文章.

3CX FQDN管理和分配

如果发现之前的FQDN已经绑定过其它的3CX，需要进行一个解绑程序。

3CX许可证密钥已绑定到另一个FQDN

二、安装3CX主程序
（一）安装WINDOWS版本的3CX
在WINDOWS安装程序比较简单。一般都不会出什么问题。我们推荐大家安装WINDOWS 2012 R2 64位。只要确认全部Windows最新的系统补丁打上，然后只要下载好WINDOWS的EXE程序。按照提示就可以完成了。

（二）安装LINUX版本的3CX
安装LINUX，我们推荐使用ISO镜像安装。如果在阿里云上安装，选择Debian 9.X系统后。我们建议查看下面这篇文章

在linux下安装3CX

或者使用LINUX的ISO镜像安装在虚拟机上。

（三）云服务器安装3CX
我们以阿里云的LINUX安装位例子。具体在阿里云的安装步骤请查看下面的内容。

在阿里云 Debian 镜像安装 3CX 注意事项

三、3CX的SIP终端部署
3CX支持标准的SIP协议终端。软件和硬件的SIP终端均可。

（一）3CX手机软电话的配置
关于苹果软电话，目前因为政府对通信技术的管控，3CX苹果软电话需要去美国的应用商店才可以下载。安卓的话。因为要用到谷歌的API激活呼入的呼叫。一旦锁屏，就无法呼入成功了。下面可以下载安卓软电话。

安卓软电话

（二）3CX网页软电话
打开指定的页面即可。这里简单叙述一下，创建好分机的时候记住填写分机使用者的邮箱，该邮箱就会收到一封邮件。使用者按照邮件的内容就可以打开网页软电话了。网页软电话是3CX V15.5发布的软电话。也是未来软电话的巨大趋势。我们推荐用户使用这个明星产品。

你的通信仪表盘 – 3CX 网页客户端

（三）3CX PC软电话的配置
关于WINDOWS平台的软电话。在每个分机创建的时候填入电子邮件。当分机创建完毕之后。会收到一封欢迎邮件，按照欢迎邮件的配置。就可以完成3CX软电话的配置了。基本框架就是安装3CX软电话之后，双击附件。就会自动导入配置了。

（四）硬件终端的配置
可能以前熟悉开源系统，比如说ASTERISK类似系统的朋友，会觉得SIP终端注册，不就是填写服务器地址，用户名和密码。就可以的吗？从狭义来说，的确是。

1.认证电话机的配置
但是3CX比这样简单的方法考虑到更多，更全面。尤其是在大型企业企业严格的多重网络。我们推荐用3CX认证的电话机，配合我们推荐的方式来进行配置。这样可以避免更多的语音通信的问题。

3CX目前认证了5家SIP电话机。只要选择3CX认证的型号，3CX就可以对下面的话机进行统一配置和管理。非常方便。如果打算更多的了解。可以查看下面的文章。

3CX认证网络电话机的说明

在了解3CX认证话机的文章后，如果要大规模快速部署3CX。我们推荐详细查看这篇文章

通过DHCP Option 66 配置部分话机

如果没有Option 66服务器，也可以手动配置。推荐查看这篇文章。我们以方位话机为例子

通过Fanvil话机网页界面输入3CX配置链接配置话机

2.手动配置SIP话机
市面上有很多主流的SIP话机，都可以注册到3CX.注册过程只要注意5个参数匹配:服务器地址，端口号，认证用户名，分机账号和密码这些参数。大概率来说，都没有大问题

如何手动配置亿联T系列话机注册到3CX

但是我们不太建议在远程分机的时候采用手动配置，如果手动配置了远程注册，请一定要设置STUN服务器，不然会有掉线概率。

NAT环境下分机注册到远程3CX需开启STUN服务器

3.思科话机配置
思科话机也可以注册到3CX。但是只能使用基本通话功能。一些呼叫转移，出席转是无法正常操作的。但是可以起到保护企业系统投资的左右。

思科某些话机型号是SCCP，这个时候就需要刷一下固件。具体查看下面的文章

将Cisco 6921/6941/6961话机从SCCP转换为SIP协议

注册方法查看下面的文章

Cisco话机如何恢复出厂设置

如何为Linux版3CX安装TFTP服务器用于配置思科等话机

4.宝利通话机的配置

有些宝利通的话机默认不是3CX支持的SIP协议，这个时候要刷下固件

如何将Polycom VVX从Lync切换到SIP

恢复默认设置

如何恢复Polycom VVX系列的出厂设置

开始配置

如何为3CX配置Polycom VVX系列话机

4.配置SIP门禁，对讲设备和广播网关
现在SIP硬件终端不仅仅是硬件电话机，还有一些其它的应用，比如说楼宇门禁，紧急对讲和门禁网关。可以查询下面的文档

配置方位门禁对讲和广播网关

5.自定义话机模板
有很多用户希望控制更多话机配置的具体参数，比如说修改话机的按键布局的自定义。还有一些话机更深层次的配置。这就需要修改话机的模板。这个部分的内容我们不太建议初学者查看。因为如果不对3CX了解深入，这些修改可能会导致IP电话机的工作不正常。请谨慎查看。

创建自定义话机模板

（五）远程注册分机的注意事项
如果是IP电话机远程注册到3CX，有下面的注意事项。建议选用TLS模式。这样通话的安全性得到保证，

Yealink 话机修改模板开启远程分机 TLS 注册

在配置远程分机的时候，会经常遇到一些注册和没有 语音流的问题。下面的文章会帮助大家解决这些问题。

3CX远程分机故障排除

另外在远程分机注册了之后，有时候会发现话机注册上了，但是3CX确显示没有注册上。我们以方位话机为例子，告诉大家排查问题的办法。

如何解决方位话机SIP线路状态与PBX不同步

（六）采用SBC注册远程分机
3CX为远程分机注册设计了一个兼具安全性和声音品质的的优选方案，部署SBC。通过这个方法，可以确保话机连接的高安全性。因为在公网上开发SIP端口是一项高风险的操作。我们推荐采用这种方式来进行远程连接。

SBC功能解读

有的朋友会问，SBC的性能到底如何？可以支持多少个电话机在后面呢？具体了解可以查看这篇文章

V16 Update 2 Beta版下的新SBC性能统计数据

在了解了，具体的安装说明后。就可以开始安装树莓派了。下面是安装的文档。

安装SBC的文档

（七）传真分机的设置
3CX传真说明

四、SIP外线的设置
中国区域的SIP外线主要有以下类型。推荐大家查看这篇文章。对3CX如何对接电话号码有更深刻的理解。

中国SIP中继类型

（一）基本的配置方法
不同的SIP外线有不同的配置方法，大家可以根据自己的外线类型来进行配置。在中国境内SIP号码没有完全开放，因此主要采取网关对接的方式实现

3CX配合FXO网关呼入呼出

有些客户会购买网关的时候会选择购买一台网关上，既有FXS也有FXO。从管理的角度来算，我们不太建议这样的设备。最好是FXS和FXO网关分开购买。不要集中在一台设备上，因为有时候线路电信的外线不小心插到FXS上会烧坏FXS网关。如果在混合部署FXO/S网关，可以查看这篇文档。

VOPTech的混合语音网关（FXO和FXS）与3CX对接

大型企业会很多用到E1网关的部署，我们推荐用户用VOPTech的语音的E1网关。

3CX与VOPTech E1网关对接

下面是一些常用网关的对接文档。

为3CX配置Grandstream FXO VoIP网关

如何使用本地3CX对接本地VOPTech的GSM无线融合语音网关

如何使用IP to IP方式为3CX配置DBL GOIP网关

中国SIP中继配置文档可以查看下面的。

移动IMS对接PBX（以3CX为例）

香港的语音专线配置

如果用户有国外电话号码的需求，这里的一个好消息是，可以和我们的合作伙伴商城购买一个国际SIP号码。不需要语音网关了。

国际SIP号码

（二）云部署对接语音网关
现在越来越多的用户选择云部署，但是云部署一个重要的问题就是，如何稳定的接入办公网络的连接本地号码的语音网关。当然如果你们公司有VPN连接办公网络。这就最好。或者购买阿里云的智能接入网关（￥600/月）也可以确保云服务器和本地号码的稳定连接。

我们现在有了一个新办法，就是把云平台3CX和本地网关进行稳定的连接。具体查看下面的文档。

FXO 网关通过 SBC 注册云端 3CX

使用3CX SBC解决4G 路由器后的GOIP网关无法注册到云端3CX的问题

（三）设置SIP中继的进阶参数
在设置SIP中继的时候，会遇到一些场景需要修改外呼的SIP协议的呼叫参数。3CX也提供了相关的设置。感兴趣的朋友可以查看下面的文章

3CX 呼出参数详解

3CX 怎么处理来电呼叫及呼叫路由

五、呼入呼出拨号规则的设置
设置好外线之后，大家如果有些基础的知识。再加上查看我们上面的文章已经可以基本的实现呼入呼出了。

如果还是不太确定。下面的文章是拨号规则的具体的设置文档

3CX外呼规则设置

3CX呼入规则设置

如果要更进一步了解呼入规则的设计，可以查看这篇文章

呼入规则 – 路由 3CX 的呼叫

如国需要呼入的电话进入IVR欢迎音。可以查看下面这篇文章

3CX数字接线员/IVR

六、如何确保3CX系统的安全性
我们有很多用户不太清楚在互联网上开放3CX的SIP端口是非常危险的。为了提高网络管理员的安全意识。我们

“强烈”
“强烈”
“强烈”
建议查看下面的文章

提高防范SIP攻击的安全意识

保护 IP PBX 系统

3CX安全必读

导致被攻击盗打发生的常见错误操作

七、3CX对接3CX或其它SIP系统/IP PBX
这里的对接方式主要3种。主要有如下方式

（一）两台3CX系统直接的对接
这种方式是我们最为推荐的。因为3CX针对多个3CX组网有有特定的设计。对接多套3CX系统。对接之后可以实现外线异地出局，和分机状态查看。

3CX系统之间对接

（二）3CX系统通过物理接口对接其它电话通信系统
这里我们以对接西门子模拟PABX向大家介绍对接的过程

3CX对接西门子程控电话交换机方案

（三）SIP协议对接其第3方系统
下面的对接是3CX通过SIP协议进行的对接。目前只能确保双方的分机可以互打成功。来电显示正常。

3CX对接思科CUCM

3CX对接skype for business

3CX对接PEXIP

如果3CX呼入遇到来电显示异常，建议查看下面的文章

3CX Caller ID重新格式化

如果从3CX 呼入到其它系统的CALLER ID 异常，请查看下面的文章

3CX与第三方IP PBX对接后的呼出参数调试

八、3CX系统的升级和迁移
3CX系统使用到了某个阶段之后。会发觉当前的功能，或者并发不够用，需要升级。这个过程很简单，只要购买相应的许可，然后在刷新许可界面的按钮就完成了。

系统功能版本的提升。如果是属于系统版本的升级。比如说，V15.5很久没有升级了。客户有需求升级到V15.5最后一个版本。可以查看下面文章。

版本15.0和15.5用户系统升级到SP6

V15.5升级到V16.一般来说，只要点击系统的升级按钮即可。但是有时候网络有问题。这就需要特别注意了。关于V15.5升级到V16如果没有看到升级按钮。可以看看下面的文章。

3CX V15.5 SP6升级到3CX V16的操作指导

还有一种情况是，LINUX的操作系统的升级。那就可以查看下面的文章

Debian 8 升级到 Debian 9

当企业有业务需求需要迁移系统比如说更换域名的时候，那就需要先把原来的域名和3CX许可解绑。具体参考下面的文章

3CX域名的管理

如发现3CX官方推送了新版本，可能系统还没有收到新版本的通知。可以尝试查看一下方法

接收V16新版本通知

九、业务系统的融合
3CX一个重要的亮点就是，它超越了电话系统的范畴。可以把其它的系统融合到一起。

（一）网站连接3CX
一个经典的场景功能就是3CX可以提供一个接口连接网站之后，为网站用户和3CX系统用户建立文字和音视频连接.3CX提供了和主流网站工具WORDPRESS联通的插件。具体的原理可以查看下面的文章。

WORDPRESS连接3CX

如果部署WORDPRESS的网站，可以查看下面的文章

非WORDPRESS网站连接3CX

（二）CRM/ERP业务系统连接3CX
1.认证CRM的配置文档
3CX提供了非常友好的API开发接口，可以轻松的和企业现有的业务系统做融合。实现电话呼叫来电弹屏，和点击拨号。

3CX在中国区域内我们推荐和ZOHO进行CRM的配合。具体文档可以查询下面的。而且ZOHO-CRM可以提供3个用户的免费版本。具体配置看下面的文档

3CX服务器设置Zoho CRM集成 – 服务器端

2.非认证CRM的配置文档
如果是非认证的CRM要和3CX配合，请参考下面的文档。

3CX 与 CRM 集成教程

最近3CX还发布了一个新工具，帮助大家快速完成3CX和非认证CRM系统的集成。

3CX CRM 生成器快速向导

（三）3CX和OFFICE 365的集成
3CX V16版本最突出的功能之一是它与Office 365的集成增强，使得功能更强大。

3CX IP PBX与Office 365保持同步

（四）酒店系统融合
3CX目前可以和Fidelio / Mitel进行酒店系统的对接。以实现叫醒，客房计费和小酒吧功能。

酒店系统设置

（五）API开发接口
3CX的API开发接口是开发给所有的用户使用的。使用接口无需额外付费。只有专业版和企业版的版本才可以使用。

3CX 开发接口call control API

十、使用CFD为企业设计符合自身业务需要的深度语音交互流程
3CX 呼叫流程设计器（以下简称 CFD）允许用户更简单地创建语音 app。这里的语音 app 是指通话话机与用户交互并执行某些逻辑的程序。比如可以创建让用户输入用户名和密码，再用数据库进行验证。由于 3CX 呼叫流程设计器完全图形化，因此不需要开发者掌握很多语音和编程方面的知识。

CFD 安装及简介
创建一个简单的 CFD 流程
CFD 工作区
CFD 组件
CFD 条件和变量
CFD 提示和表达式
CFD 错误排查
十一、3CX的双机备份
3CX的双机备份，不需要购买两套许可。在局域网内的双机备份，使用专业版和企业版都可以实现。也就是一套许可安装在两台机器上。具体的原理是通过DNS解析来实现。

WINDOWS和LINUX都可以实现双机备份。有一点要注意的是，解析服务器也必须是相同操作系统的。比如说LINUX的系统，要使用WINDOWS解析服务器是不可能的。备机发现主机不在线后，要运行一个脚本修改解析记录。因为LINUX脚本无法修改WINDOWS服务器的解析记录。

我们以 linux为例子，linux下面是LINUX版本安装双机备份的文章

3CX SIP服务器linux 双机备份设置

但是在某些应用场景中，是不允许修改DNS解析服务器的。这里有一个非3CX方法的方法实现双机备份。有兴趣的朋友可以看看。

利用 KeepAlived 实现 3CX 高可用

--参考文章来自知乎[3CX-SIP企业通信系统部署导读](https://zhuanlan.zhihu.com/p/84370831)
